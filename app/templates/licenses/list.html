{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Software Licenses</h2>
  <div>
    {% if current_user.role in ['Admin', 'IT', 'Manager'] %}
      <a href="{{ url_for('main.export_licenses_csv') }}" class="btn btn-outline-primary me-2">ðŸ“¥ Export CSV</a>
      <a href="{{ url_for('main.export_licenses_excel') }}" class="btn btn-outline-success me-2">ðŸ“Š Export Excel</a>
    {% endif %}
    {% if current_user.role in ['Admin', 'IT'] %}
      <a href="{{ url_for('main.license_new') }}" class="btn btn-primary">Add License</a>
    {% endif %}
  </div>
</div>
<table class="table table-sm table-hover">
 <thead class="table-light"><tr><th>No.</th><th>ID</th><th>Software</th><th>Key</th><th>Expiry</th><th>Assigned To</th>{% if current_user.role in ['Admin', 'IT'] %}<th>Actions</th>{% endif %}</tr></thead>
 <tbody>
 {% for l in licenses %}<tr><td>{{ loop.index }}</td><td>{{ l.id }}</td><td>{{ l.software_name }}</td><td>{{ l.license_key }}</td><td>{{ l.expiry_date }}</td><td>{{ l.employee.name if l.employee else '' }}</td>
  {% if current_user.role in ['Admin', 'IT'] %}
    <td>
      <a href="{{ url_for('main.license_edit', lid=l.id) }}" class="btn btn-sm btn-primary">Edit</a>
      <form action="{{ url_for('main.license_delete', lid=l.id) }}" method="post" style="display:inline-block" onsubmit="return confirm('Delete license?');">
        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
      </form>
    </td>
  {% endif %}
 </tr>{% endfor %}
 </tbody>
</table>
{% endblock %}
