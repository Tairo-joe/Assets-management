{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Maintenance Records</h2>
  <div>
    {% if current_user.role in ['Admin', 'IT', 'Manager'] %}
      <a href="{{ url_for('main.export_maintenance_csv') }}" class="btn btn-outline-primary me-2">ðŸ“¥ Export CSV</a>
      <a href="{{ url_for('main.export_maintenance_excel') }}" class="btn btn-outline-success me-2">ðŸ“Š Export Excel</a>
    {% endif %}
    {% if current_user.role in ['Admin', 'IT'] %}
      <a href="{{ url_for('main.maintenance_new') }}" class="btn btn-primary">Add Maintenance</a>
    {% endif %}
  </div>
</div>
<table class="table table-sm table-hover">
  <thead class="table-light"><tr><th>ID</th><th>Asset</th><th>Date</th><th>Description</th><th>Cost</th><th>Status</th>{% if current_user.role in ['Admin', 'IT'] %}<th>Actions</th>{% endif %}</tr></thead>
  <tbody>
  {% for m in maintenances %}<tr><td>{{ m.id }}</td><td>{{ m.asset.asset_id if m.asset else '' }}</td><td>{{ m.date }}</td><td>{{ m.description }}</td><td>{{ m.cost|ghs }}</td>
  <td>{% if m.status == 'Approved' %}<span class="badge bg-success">Approved</span>{% else %}<span class="badge bg-warning text-dark">Pending</span>{% endif %}</td>
  {% if current_user.role in ['Admin', 'IT'] %}
    <td>
      <a href="{{ url_for('main.maintenance_edit', mid=m.id) }}" class="btn btn-sm btn-primary">Edit</a>
      {% if current_user.role == 'Admin' and m.status != 'Approved' %}
      <form method="post" style="display:inline-block">
        <button type="submit" formaction="{{ url_for('main.maintenance_approve', mid=m.id) }}" class="btn btn-sm btn-success">Approve</button>
      </form>
      {% endif %}
      <form method="post" style="display:inline-block" onsubmit="return confirm('Delete maintenance?');">
        <button type="submit" formaction="{{ url_for('main.maintenance_delete', mid=m.id) }}" class="btn btn-sm btn-danger">Delete</button>
      </form>
    </td>
  {% endif %}
  </tr>{% endfor %}
  </tbody>
</table>
{% endblock %}
